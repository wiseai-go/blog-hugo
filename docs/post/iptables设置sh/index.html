<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="theme-color" content="dark">
    <title>通过iptables设置防火墙 | WiseAI的博客</title>

    
    
    
    <meta property="og:site_name" content="wiseai的备忘录" />
    <meta property="og:title" content="通过iptables设置防火墙 | WiseAI的博客"/>
    <meta itemprop="name" content="通过iptables设置防火墙 | WiseAI的博客" />
    <meta name="twitter:title" content="通过iptables设置防火墙 | WiseAI的博客" />
    <meta name="application-name" content="通过iptables设置防火墙 | WiseAI的博客" /><meta name="twitter:card" content="summary"/>

    <meta name="description" content="通过iptables设置防火墙" />
    <meta name="twitter:description" content="通过iptables设置防火墙 "/>
    <meta itemprop="description" content=" 通过iptables设置防火墙 "/>
    <meta property="og:description" content=" 通过iptables设置防火墙 " />

    

<meta property="og:type" content="article" />
<meta property="article:publisher" content="wiseai" />
<meta property="og:article:published_time" content=2022-05-30T00:00:00Z />
<meta property="article:published_time" content=2022-05-30T00:00:00Z />


  <meta property="og:article:author" content="Wiseai" />
  <meta property="article:author" content="Wiseai" />
  <meta name="author" content="Wiseai" />




<script defer type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "通过iptables设置防火墙",
    "author": {
      "@type": "Person",
      "name": "wiseai"
    },
    "datePublished": "2022-05-30",
    "description": "通过iptables设置防火墙",
    "wordCount":  357 ,
    "mainEntityOfPage": "True",
    "dateModified": "2022-05-30",
    "publisher": {
      "@type": "Organization",
      "name": "wiseai",
      "logo": {
        "@type": "imageObject",
        "url": "https:\/\/blog.wiseai.cn\/favicon.ico"
      }
    }
  }
</script>



    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    
    <link rel="stylesheet" href="/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css">
    <link rel="stylesheet" href="/css/wiseai.css">
</head>
    
    <script>
        (function() {
            const colorSchemeKey = 'ThemeColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'ThemeColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.userColorScheme = 'dark';
        } else {
            document.documentElement.dataset.userColorScheme = 'light';
        }
    })();
</script>


    <body class="dark">
        <nav class="navbar">
    <div class="container">
        <div class="flex">
            <div>
                <a class="brand" href="/">
                    
                    <span class="emoji">
                        ✨
                    </span>
                    
                    
                    WiseAI的博客
                    </a>
            </div>
            <div class="flex">
                
                <a href="/articles/">文章</a>
                
                <a href="/categories/">分类</a>
                
                <a href="/tags/">关键字</a>
                
                
                    <button id="dark-mode-button">
                    <svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163 0 1 0 1.643 1.641a1.163 1.163 0 0 0-1.643-1.641zm-16.022 14.38a1.74 1.74 0 0 0 0 2.465a1.742 1.742 0 1 0 0-2.465zm13.968-2.147a2.904 2.904 0 0 1-4.108 0a2.902 2.902 0 0 1 0-4.107a2.902 2.902 0 0 1 4.108 0a2.902 2.902 0 0 1 0 4.107z" fill="#FFCC4D"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                    <svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M16 2s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2V2zm18 14s2 0 2 2s-2 2-2 2h-2s-2 0-2-2s2-2 2-2h2zM4 16s2 0 2 2s-2 2-2 2H2s-2 0-2-2s2-2 2-2h2zm5.121-8.707s1.414 1.414 0 2.828s-2.828 0-2.828 0L4.878 8.708s-1.414-1.414 0-2.829c1.415-1.414 2.829 0 2.829 0l1.414 1.414zm21 21s1.414 1.414 0 2.828s-2.828 0-2.828 0l-1.414-1.414s-1.414-1.414 0-2.828s2.828 0 2.828 0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zM16 32s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2v-2z"/><circle fill="#FFD983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                    </button>
                
            </div>
            </div>
    </div>
</nav>

        <main>
            
<div class="container">
    <article>
        <header class="article-header">
            <div class="thumb">
                <div>
                    <h1>通过iptables设置防火墙</h1>
                    <div class="post-meta">
                        <div>
                            
                            
                            By wiseai | <time>2022-05-30</time>
                            | 2 minutes
                        </div>
                        <div class="tags">
                            
                            <a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/">防火墙</a>
                            
                            <a href="/tags/sh/">sh</a>
                            
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </article>

    <div class="article-post">
    <pre tabindex="0"><code>    #!/bin/bash

    PATH=/sbin:/bin:/usr/sbin:/usr/bin

    #设置网卡
    wk=&#34;eth1&#34;

    # 1. 清除规则
    iptables -F
    iptables -X
    iptables -Z

    # 2. 设定政策
    iptables -P INPUT DROP
    iptables -P OUTPUT ACCEPT
    iptables -P FORWARD ACCEPT

    # 3~5. 制订各项规则
    iptables -A INPUT -i lo -j ACCEPT
    iptables -A INPUT -i $wk -m state --state RELATED,ESTABLISHED -j ACCEPT

    #samba服务
    iptables -A INPUT -i $wk -p tcp --dport 139 -j ACCEPT
    iptables -A INPUT -i $wk -p tcp --dport 445 -j ACCEPT
    iptables -A INPUT -i $wk -p udp --dport 137:138 -j ACCEPT

    #vsftp服务
    iptables -A INPUT -i $wk -p tcp --dport 21 -j ACCEPT
    iptables -A INPUT -i $wk -p tcp --dport 1024:65535 -j ACCEPT
    #iptables -A INPUT -i $wk -s 192.168.1.0/24 -j ACCEPT
</code></pre><p><strong>1.查看防火墙规则</strong></p>
<p><code># iptables [-t tables] [-L] [-nv] </code>
选项与参数：
-t ：后面接table ，例如nat或filter，若省略此项目，则使用预设的filter
-L ：列出目前的table的规则
-n ：不进行IP 与HOSTNAME 的反查，显示速度会快很多！
-v ：列出更多的相关信息</pre></p>
<p><strong>2.清除规则</strong>
<code># iptables [-t tables] [-FXZ] </code>
选项与参数：
-F ：清除所有的已订定的规则；
-X ：杀掉所有使用者&quot;自订&quot; 的chain；
-Z ：将所有的chain 的计数与流量统计都归零</pre></p>
<p><strong>3.定义预设政策(policy)</strong>
<code># iptables [-t nat] -P [INPUT,OUTPUT,FORWARD] [ACCEPT,DROP] </code>
选项与参数：
-P ：定义政策( Policy )。注意，这个P为大写啊！
ACCEPT ：该封包可接受
DROP ：该封包直接丢弃，不会让client 端知道为何被丢弃。</p>
<p>范例：将本机的INPUT设定为DROP ，其他设定为ACCEPT</p>
<pre tabindex="0"><code># iptables -P INPUT DROP 
# iptables -P OUTPUT ACCEPT 
# iptables -P FORWARD ACCEPT 
# iptables -t nat -P PREROUTING ACCEPT
# iptables -t nat -P POSTROUTING ACCEPT
# iptables -t nat -P INPUT ACCEPT
# iptables -t nat -P OUTPUT ACCEPT
</code></pre><p><strong>nat表不用于过滤，所以不能设置为DROP</strong>
<strong>4.定义规则</strong>
<code># iptables [-AI链名] [-io网络界面] [-p协议] [-s来源IP/网域] [-sport 端口范围] [-d目标IP/网域] [-dport 端口范围] -j [ACCEPT'DROP'REJECT'LOG] </code>
选项与参数：</p>
<pre tabindex="0"><code>-AI链名：规则的&#34;插入&#34;或&#34;增加&#34;
-A：新增加一条规则，该规则增加在原本规则的最后面。例如原本已经有四条规则，使用-A就可以加上第五条规则！
-I：插入一条规则。如果没有指定此规则的顺序，预设是插入变成第一条规则。
例如原本有四条规则，使用-I则该规则变成第一条，而原本四条变成2~5号
链：有INPUT，OUTPUT，FORWARD等，此链名称又与-io有关，请看底下。
-io网卡：设定封包进出的规范
-i：封包所进入的那个网卡，例如eth0，lo等网卡。需与INPUT链配合；
-o：封包所传出的那个网卡，需与OUTPUT链配合；
-p协议：设定此规则适用于哪种封包格式
主要的封包格式有：tcp，udp，icmp及all。
-s来源IP/网域：设定此规则之封包的来源项目，可指定单纯的IP或包括网域，例如：
IP :192.168.0.100
网域：192.168.0.0/24，192.168.0.0/255.255.255.0均可。
若规范为『不许』时，则加上！即可，例如：
-s！192.168.100.0/24表示不许192.168.100.0/24封包来源；
-d目标IP/网域：同-s，只不过这里指的是目标的IP或网域。
--sport 来源端口范围。例如 1024:65535 
--dport 目标端口范围
-j：后面接动作，主要的动作有接受（ACCEPT）、丢弃（DROP）、拒绝（REJECT）及记录（LOG） 
</code></pre><p><code># iptables -A INPUT [-m state] [--state状态]  </code>
选项与参数：</p>
<pre tabindex="0"><code>-m：一些iptables的外挂模块，主要常见的有：  
          state：状态模块  
          mac：网络卡硬件地址（hardware address）  
--state：一些封包的状态，主要有：  
         INVALID：无效的封包，例如数据破损的封包状态  
        ESTABLISHED：已经联机成功的联机状态；  
        NEW：想要新建立联机的封包状态；  
       RELATED：这个最常用！表示这个封包是与我们主机发送出去的封包有关  
</code></pre><p>例：只要已建立或相关封包就予以通过，只要是不合法封包就丢弃 <br>
<code># iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT  </code>
<code># iptables -A INPUT -m state --state INVALID -j DROP</code>
对MAC地址为aa:bb:cc:dd:ee:ff主机开放其连接
<code># iptables -A INPUT -m mac --mac-source aa:bb:cc:dd :ee:ff -j ACCEPT </code>
选项与参数：</p>
<pre tabindex="0"><code>--mac-source ：就是来源主机的MAC
</code></pre><p><strong>ICMP 封包规则：针对是否回应ping 来设计</strong></p>
<p>通常我们会把ICMP type 8 (echo request)去掉而已，让远端主机不知道我们是否存在，也不会接受ping的回应。
<code># iptables -A INPUT [-p icmp] [--icmp-type类型] -j ACCEPT </code>
选项与参数：</p>
<pre tabindex="0"><code>--icmp-type ：后面必须要接ICMP 的封包类型，也可以使用代号，
              例如8 代表echo request 的意思。
</code></pre><p>例：让0,3,4,11,12,14,16,18的ICMP type可以进入本机：</p>
<pre tabindex="0"><code>#!/bin/bash 
icmp_type=&#34;0 3 4 11 12 14 16 18&#34; 
for typeicmp in $icmp_type 
do 
    iptables -A INPUT -i eth0 -p icmp --icmp-type $typeicmp -j ACCEPT 
done
</code></pre>
    </div>
</div>

<div class="container">
    
    <nav class="flex container suggested">
        
        <a rel="prev" href="/post/footnote/" title="Previous post (older)">
            <span>Previous</span>
            Footnote test
            </a>
        
        
        
        <a rel="next" href="/post/linux%E6%9B%B4%E6%8D%A2%E7%BD%91%E5%8D%A1%E5%90%8E%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E4%B8%8D%E8%83%BD%E5%90%AF%E5%8A%A8%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/" title="Next post (newer)">
            <span>Next</span>
            Linux更换网卡后网络服务不能启动的问题解决办法
            </a> 
        
    </nav>
    
</div>
 
<div class="container">
    
</div>

</main>


        </main>
        <footer class="footer flex">
    <section class="container">
        <nav class="footer-links">
            
            <a href="https://wiseai.gitee.io/pages/gnzg/index.html">孤鸟之歌</a>
            
            <a href="https://wiseai.gitee.io/pages/mm/index.html">生成随机字符</a>
            
            <a href="https://wiseai.gitee.io/pages/md/index.html">MarkDown</a>
            
            <a href="https://gitee.com/">Gitee</a>
            
            <a href="https://github.com/">Github</a>
            
            <a href="https://www.oschina.net/">OSCHINA</a>
            
            <a href="https://gitee.com/wiseai/the-way-to-go_ZH_CN/blob/master/eBook/directory.md">the way to go</a>
            
            <a href="https://goframe.org/display/gf">GoFrame</a>
            
            <a href="https://www.aliyundrive.com/">阿里云盘</a>
            
            <a href="https://www.bootstrap.cn/">bootstrap文档</a>
            
            <a href="https://www.58pic.com/">千图</a>
            
            <a href="https://marketing.qiniu.com/">七牛云</a>
            
            <a href="https://www.ixigua.com/">西瓜视频</a>
            
            <a href="https://wiseai.gitee.io/pages/yugang/index.html">鱼缸计算</a>
            
            <a href="/index.xml">RSS</a>
            
        </nav>

        
    </section>
    <script defer src="/ts/features.2f98c2f5215583b54b0a8bd7bdb10411467f4fee386a61e03ca3ddf376273fc4.js" 
    data-enable-footnotes="true"
    ></script>
</footer>

    </body>
</html>